# Onboarding Assistant CLI Tools

This directory contains CLI tools for the Onboarding Assistant:

1. **Metadata Generator**: Scans source code to extract contextual metadata
2. **Embedding Upload Tool**: Converts metadata to embeddings and uploads them to OpenAI

## Metadata Generator

This tool scans source code files (.vue, .cs, .json) to extract contextual metadata for the Onboarding Assistant. The metadata is output as structured JSON files that can be used for RAG (Retrieval Augmented Generation) embedding with OpenAI.

## Prerequisites

- Python 3.6 or higher

## Installation

No installation is required. Simply ensure you have Python installed.

## Usage

```bash
python metadata_generator.py <source_dir> --output-dir <output_dir>
```

### Arguments

- `source_dir`: The directory containing the source code to scan (required)
- `--output-dir`, `-o`: The directory where metadata JSON files will be output (default: "./output")

### Example

```bash
# Scan the ServiceManager app and output metadata to the backend Data directory
python metadata_generator.py C:/path/to/ServiceManager --output-dir ../backend/Data
```

## Output Format

The tool generates JSON files with the following structure:

```json
{
  "route": "/dashboard",
  "description": "Main dashboard displaying widgets.",
  "elements": [
    {"id": "widget-list", "description": "List of user widgets"},
    {"id": "refresh-button", "description": "Refresh data"}
  ],
  "apiCalls": ["/api/dashboard"],
  "dependencies": ["WidgetComponent", "ChartComponent"],
  "userActions": ["View widgets", "Refresh data"]
}
```

## Framework Compatibility

The tool is designed to work with various frontend frameworks, with different levels of support:

- **Vue.js**: Optimized support with detailed extraction of components, props, and Vue-specific patterns
- **React**: Basic support for component extraction and JSX parsing
- **Angular**: Basic support for component and template extraction
- **Plain HTML/JS**: Can extract elements with IDs and comments
- **.NET/C#**: Extracts API routes and controller actions from backend code

While the tool works best with Vue.js applications, it will still extract useful metadata from other frameworks. Future versions will include enhanced support for React, Angular, and other popular frameworks.

## How It Works

The tool uses pattern matching and static analysis to extract:

1. **Routes**: Determined from file paths or explicit route definitions
2. **UI Elements**: Extracted from HTML elements with IDs or ref attributes
3. **API Calls**: Found in axios/fetch calls or API controller definitions
4. **Dependencies**: Identified from component imports and registrations
5. **User Actions**: Inferred from method names and event handlers

For best results, include descriptive comments in your code, especially near UI elements. When using non-Vue frameworks, adding clear ID attributes to important UI elements and descriptive comments will improve extraction quality.

## Embedding Upload Tool

This tool automates the process of generating and uploading text embeddings to OpenAI's Embedding API. It converts metadata files into embedding-ready format and stores the resulting embeddings locally.

### Prerequisites

- Python 3.6 or higher
- OpenAI Python client library (`pip install openai`)
- PyYAML (`pip install pyyaml`)
- tqdm (`pip install tqdm`)

### Configuration

Before using the tool, you need to create a YAML configuration file with your OpenAI API credentials and other settings. A sample configuration file is provided at `config/assistant_config.yaml`.

```yaml
# OpenAI API credentials
openai_api_key: "sk-your-api-key-here"  # Replace with your actual OpenAI API key
assistant_id: "asst_your-assistant-id-here"  # Replace with your OpenAI Assistant ID

# Embedding model to use
embedding_model: "text-embedding-3-small"

# Paths for metadata and embeddings
metadata_path: "./output"  # Path to the metadata files generated by metadata_generator.py
index_path: "./output/embeddings.json"  # Path where embeddings will be stored

# Format for embeddings (currently only OpenAI is supported)
embedding_format: "openai"  # Future: pinecone, weaviate
```

### Usage

```bash
python upload_embeddings.py --config <config_file_path>
```

### Arguments

- `--config`: Path to the YAML configuration file (default: "./config/assistant_config.yaml")
- `--force`: Force processing of all files, even if unchanged
- `--verbose`: Print verbose output
- `--quiet`: Suppress progress bar and non-error output

### Example Workflow

```bash
# Step 1: Generate metadata from source code
python metadata_generator.py ./src --output-dir ./output

# Step 2: Upload embeddings to OpenAI
python upload_embeddings.py --config ./config/assistant_config.yaml
```

### Features

- **File Hashing**: Tracks file changes to avoid reprocessing unchanged files
- **Error Handling**: Retries failed API calls with exponential backoff
- **Progress Tracking**: Shows a progress bar with ETA
- **Detailed Logging**: Logs errors to `logs/errors.log`

### Output

The tool generates two output files:

1. **embeddings.json**: Contains the embeddings for each route

```json
{
  "/route": {
    "embedding": [0.123, 0.456, ...],
    "text": "ROUTE: /route\n\nDESCRIPTION: ..."
  }
}
```

2. **hashes.json**: Tracks file hashes to avoid reprocessing unchanged files

```json
{
  "/route": {
    "hash": "ae1f2c...4e",
    "last_updated": "2025-05-15T14:00:00Z"
  }
}
```
